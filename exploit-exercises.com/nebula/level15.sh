#!/bin/bash
##
#
##

# get the first location viewed by dlopen()
# open("/var/tmp/flag15/tls/i686/sse2/cmov/libc.so.6", O_RDONLY) = -1 ENOENT (No such file or directory)
LIBCLOC=$(strace ~flag15/flag15 2>&1 >/dev/null | grep "^open.*ENOENT" | head -n 1)

# parse what we have been given to acquire the libary name
IFS="\""       # set delimiter to "
set ${LIBCLOC} # split
unset IFS      # set delimiter to default

# we want the library name
# /var/tmp/flag15/tls/i686/sse2/cmov/libc.so.6
LIBC=${2}

# create the directory (if it doesn't yet exist)
mkdir -p `dirname ${LIBC}`
cd `dirname ${LIBC}` # move there to continue

# create a build location
mkdir -p lib && cd lib

##
# do stuff
##

# clean up the area
rm -Rf /var/tmp/*
