#!/bin/bash
# make the function getuid() to override the default one
C="
#include<stdio.h>
#include<sys/types.h>

uid_t
getuid(void)
{
  return 1000;
}"

# have we created the C file?
if [[ ! -f level13.c ]]; then
  echo -e "${C}" > level13.c
fi

# compile it into a share library (liblevel13.so)
gcc -Wall -fPIC -c level13.c
gcc -shared -W1,-soname,liblevel13.so -o liblevel13.so level13.o

# copy the executable to our home, changeing permissions on the way
cp /home/flag13/flag13 .

# run the command with the library (to override)
LD_PRELOAD=./liblevel13.so ./flag13

# clean up afterwards
rm level13.c level13.o liblevel13.so flag13
